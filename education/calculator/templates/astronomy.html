<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è 3D –û–±—Å–µ—Ä–≤–∞—Ç–æ—Ä–∏—è</title>
    <script src="https://unpkg.com/three@0.132.2/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <script src="https://unpkg.com/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
            font-family: 'Orbitron', sans-serif;
        }

        canvas {
            display: block;
        }

        #info-panel {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 20, 50, 0.9);
            padding: 20px;
            border-radius: 15px;
            color: white;
            width: 30%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 0 20px rgba(0, 191, 255, 0.7);
            backdrop-filter: blur(10px);
            transition: opacity 0.5s;
        }

        #info-panel img {
            width: 150px;
            height: 120px;
            border-radius: 50%;
            margin-bottom: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        #info-panel h2 {
            margin: 0;
            font-size: 24px;
            color: #00ffcc;
        }

        #info-panel p {
            margin: 5px 0;
            font-size: 16px;
            color: #ffffff;
        }

        #focus-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(50, 50, 100, 0.9);
            padding: 15px;
            border-radius: 15px;
            color: white;
            display: flex;
            flex-direction: column;
            gap: 10px;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.7);
            backdrop-filter: blur(10px);
        }

        button {
            background: linear-gradient(135deg, #ff007f, #7f00ff);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            font-family: 'Orbitron', sans-serif;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300%;
            height: 300%;
            background: rgba(255, 255, 255, 0.2);
            transition: 0.5s;
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
        }

        button:hover::before {
            transform: translate(-50%, -50%) scale(1);
        }

        button:hover {
            box-shadow: 0 0 20px rgba(255, 0, 127, 0.8);
        }

        #exit-observe {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff0000, #ff7300);
            color: white;
            padding: 12px 20px;
            border-radius: 30px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
            text-transform: uppercase;
            font-family: 'Orbitron', sans-serif;
        }

        #exit-observe:hover {
            box-shadow: 0 0 20px rgba(255, 115, 0, 0.8);
        }

        #constellation-info-panel {
            position: fixed;
            top: 175px;
            left: 20px;
            background: rgba(20, 20, 50, 0.9);
            padding: 20px;
            border-radius: 15px;
            color: white;
            width: 300px;
            box-shadow: 0 0 20px rgba(0, 191, 255, 0.7);
            backdrop-filter: blur(10px);
            transition: opacity 0.5s;
            z-index: 1000;
        }
        
        #constellation-info-panel h2 {
            margin: 0;
            font-size: 24px;
            color: #00ffcc;
        }
        
        #constellation-info-panel p {
            margin: 5px 0;
            font-size: 16px;
            color: #ffffff;
        }

        #search-panel {
            position: fixed;
            top: 60px;
            left: 20px;
            background: rgba(20, 20, 50, 0.9);
            padding: 15px;
            border-radius: 15px;
            color: white;
            box-shadow: 0 0 20px rgba(0, 191, 255, 0.7);
            backdrop-filter: blur(10px);
            z-index: 1000;
        }
        
        #search-input {
            width: 200px;
            padding: 8px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-family: 'Orbitron', sans-serif;
        }
        
        #search-results {
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .constellation-label {
            position: absolute;
            color: #00ffcc;
            font-size: 12px;
            font-family: 'Orbitron', sans-serif;
            pointer-events: none;
            z-index: 1000;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–ª–∞–Ω—à–µ—Ç–æ–≤ (—à–∏—Ä–∏–Ω–∞ —ç–∫—Ä–∞–Ω–∞ –¥–æ 1024px) */
        @media (max-width: 1024px) {
            #info-panel {
                width: 50%;
                padding: 15px;
            }

            #info-panel img {
                width: 120px;
                height: 100px;
            }

            #info-panel h2 {
                font-size: 20px;
            }

            #info-panel p {
                font-size: 14px;
            }

            #focus-panel {
                top: 15px;
                right: 15px;
                padding: 10px;
            }

            button {
                padding: 10px 15px;
                font-size: 14px;
            }

            #exit-observe {
                padding: 10px 15px;
                font-size: 14px;
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (—à–∏—Ä–∏–Ω–∞ —ç–∫—Ä–∞–Ω–∞ –¥–æ 768px) */
        @media (max-width: 768px) {
            #info-panel {
                width: 95%;
                bottom: 10px;
                left: 50%;
                transform: translateX(-50%);
                padding: 10px;
            }

            #info-panel img {
                width: 100px;
                height: 80px;
            }

            #info-panel h2 {
                font-size: 18px;
            }

            #info-panel p {
                font-size: 12px;
            }

            #focus-panel {
                top: 10px;
                right: 10px;
                padding: 8px;
            }

            button {
                padding: 8px 12px;
                font-size: 12px;
            }

            #exit-observe {
                padding: 8px 12px;
                font-size: 12px;
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ (—à–∏—Ä–∏–Ω–∞ —ç–∫—Ä–∞–Ω–∞ –¥–æ 480px) */
        @media (max-width: 480px) {
            #info-panel {
                width: 100%;
                bottom: 5px;
                padding: 8px;
            }

            #info-panel img {
                width: 80px;
                height: 60px;
            }

            #info-panel h2 {
                font-size: 16px;
            }

            #info-panel p {
                font-size: 10px;
            }

            #focus-panel {
                top: 5px;
                right: 5px;
                padding: 5px;
            }

            button {
                padding: 6px 10px;
                font-size: 10px;
            }

            #exit-observe {
                padding: 6px 10px;
                font-size: 10px;
            }
        }
    </style>
</head>
<a href="{% url 'index' %}" class="button">üìö –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
<body>
    <button id="exit-observe" style="display: none;">–í—ã–π—Ç–∏ –∏–∑ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è</button>
    <div id="info-panel" style="display: none;">
        <img id="info-image" src="" alt="–ü–ª–∞–Ω–µ—Ç–∞">
        <h2 id="info-name"></h2>
        <p id="info-description"> </p>
        <p><strong>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –°–æ–ª–Ω—Ü–∞:</strong> <span id="info-distance"></span> –º–ª–Ω –∫–º</p>
        <p><strong>–î–∏–∞–º–µ—Ç—Ä:</strong> <span id="info-diameter"></span> –∫–º</p>
        <p><strong>–°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</strong> <span id="info-temperature"></span> ¬∞C</p>
    </div>

    <div id="constellation-info-panel" style="display: none;">
        <button id="close-constellation-info" style="position: absolute; top: 10px; right: 10px; background: none; border: none; color: white; font-size: 16px; cursor: pointer;">√ó</button>
        <h2 id="constellation-name"></h2>
        <p id="constellation-description"></p>
        <p><strong>–ó–≤–µ–∑–¥—ã:</strong> <span id="constellation-stars"></span></p>
        <p><strong>–ú–∏—Ñ–æ–ª–æ–≥–∏—è:</strong> <span id="constellation-mythology"></span></p>
        <p><strong>–õ—É—á—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:</strong> <span id="constellation-best-view"></span></p>
    </div>

    <div id="search-panel">
        <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ —Å–æ–∑–≤–µ–∑–¥–∏—è..." />
        <div id="search-results"></div>
    </div>

    <div id="focus-panel"></div>

    <script>
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 20000);
        camera.position.set(0, 300, 1000);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.outputEncoding = THREE.sRGBEncoding;
        document.body.appendChild(renderer.domElement);

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        camera.position.set(0, 250, 1200);
        controls.target.set(0, 0, 0);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.2;
        controls.minDistance = 200;
        controls.maxDistance = 5000;
        controls.maxPolarAngle = Math.PI / 2;

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
        scene.add(ambientLight);

        const sunLight = new THREE.PointLight(0xffffff, 2, 10000, 2);
        sunLight.position.set(0, 0, 0);
        sunLight.castShadow = true;
        sunLight.shadow.mapSize.width = 2048;
        sunLight.shadow.mapSize.height = 2048;
        scene.add(sunLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 0.5);
        dirLight.position.set(5, 10, 2);
        dirLight.castShadow = true;
        scene.add(dirLight);

        const planets = {};
        let focusedPlanet = null;

        const planetData = [
        {
            name: '–ú–µ—Ä–∫—É—Ä–∏–π',
            size: 5,
            distance: 80,
            orbitSpeed: 4.15,
            color: 0xaaaaaa,
            img: 'https://solarsystem.nasa.gov/system/feature_items/images/18_mercury_new.png',
            modelUrl: 'https://raw.githubusercontent.com/2ndVariety/3d-models/master/planets/mercury.glb',
            description: '–ë–ª–∏–∂–∞–π—à–∞—è –∫ –°–æ–ª–Ω—Ü—É –ø–ª–∞–Ω–µ—Ç–∞.',
            diameter: 4879,
            temperature: 167,
            gravity: 3.7,
            dayLength: 4222.6, // –í —á–∞—Å–∞—Ö
            moons: []
        },
        {
            name: '–í–µ–Ω–µ—Ä–∞',
            size: 10,
            distance: 120,
            orbitSpeed: 1.62,
            color: 0xffaa33,
            img: 'https://solarsystem.nasa.gov/system/feature_items/images/27_venus_jg.png',
            modelUrl: 'https://raw.githubusercontent.com/2ndVariety/3d-models/master/planets/venus.glb',
            description: '–í—Ç–æ—Ä–∞—è –ø–ª–∞–Ω–µ—Ç–∞ –æ—Ç –°–æ–ª–Ω—Ü–∞.',
            diameter: 12104,
            temperature: 464,
            gravity: 8.87,
            dayLength: 2802, // –í —á–∞—Å–∞—Ö
            moons: []
        },
        {
            name: '–ó–µ–º–ª—è',
            size: 12,
            distance: 160,
            orbitSpeed: 1,
            color: 0x3399ff,
            img: 'https://solarsystem.nasa.gov/system/feature_items/images/17_earth.png',
            modelUrl: 'https://raw.githubusercontent.com/2ndVariety/3d-models/master/planets/earth.glb',
            description: '–ù–∞—à –¥–æ–º.',
            diameter: 12742,
            temperature: 15,
            gravity: 9.81,
            dayLength: 24,
            moons: ['–õ—É–Ω–∞']
        },
        {
            name: '–ú–∞—Ä—Å',
            size: 8,
            distance: 220,
            orbitSpeed: 0.53,
            color: 0xff3300,
            img: 'https://solarsystem.nasa.gov/system/feature_items/images/19_mars.png',
            modelUrl: 'https://raw.githubusercontent.com/2ndVariety/3d-models/master/planets/mars.glb',
            description: '–ö—Ä–∞—Å–Ω–∞—è –ø–ª–∞–Ω–µ—Ç–∞.',
            diameter: 6779,
            temperature: -63,
            gravity: 3.71,
            dayLength: 24.6,
            moons: ['–§–æ–±–æ—Å', '–î–µ–π–º–æ—Å']
        },
        {
            name: '–Æ–ø–∏—Ç–µ—Ä',
            size: 30,
            distance: 320,
            orbitSpeed: 0.084,
            color: 0xff9933,
            img: 'https://solarsystem.nasa.gov/system/feature_items/images/16_jupiter_new.png',
            modelUrl: 'https://raw.githubusercontent.com/2ndVariety/3d-models/master/planets/jupiter.glb',
            description: '–ö—Ä—É–ø–Ω–µ–π—à–∞—è –ø–ª–∞–Ω–µ—Ç–∞.',
            diameter: 139820,
            temperature: -145,
            gravity: 24.79,
            dayLength: 9.9,
            moons: ['–ò–æ', '–ï–≤—Ä–æ–ø–∞', '–ì–∞–Ω–∏–º–µ–¥', '–ö–∞–ª–ª–∏—Å—Ç–æ', '–∏ –µ—â–µ 75']
        },
        {
            name: '–°–∞—Ç—É—Ä–Ω',
            size: 28,
            distance: 420,
            orbitSpeed: 0.034,
            color: 0xffcc99,
            img: 'https://solarsystem.nasa.gov/system/feature_items/images/28_saturn.png',
            modelUrl: 'https://raw.githubusercontent.com/2ndVariety/3d-models/master/planets/saturn.glb',
            description: '–ü–ª–∞–Ω–µ—Ç–∞ —Å –∫–æ–ª—å—Ü–∞–º–∏.',
            diameter: 116460,
            temperature: -178,
            gravity: 10.44,
            dayLength: 10.7,
            moons: ['–¢–∏—Ç–∞–Ω', '–≠–Ω—Ü–µ–ª–∞–¥', '–ú–∏–º–∞—Å', '–¢–µ—Ñ–∏—è', '–î–∏–æ–Ω', '–†–µ—è', '–Ø–ø–µ—Ç', '–∏ –µ—â–µ 80'],
            hasRings: true
        },
        {
            name: '–£—Ä–∞–Ω',
            size: 20,
            distance: 520,
            orbitSpeed: 0.012,
            color: 0x99ccff,
            img: 'https://solarsystem.nasa.gov/system/feature_items/images/29_uranus.png',
            modelUrl: 'https://raw.githubusercontent.com/2ndVariety/3d-models/master/planets/uranus.glb',
            description: '–õ–µ–¥—è–Ω–æ–π –≥–∏–≥–∞–Ω—Ç.',
            diameter: 50724,
            temperature: -224,
            gravity: 8.69,
            dayLength: 17.2,
            moons: ['–ú–∏—Ä–∞–Ω–¥–∞', '–ê—Ä–∏—ç–ª—å', '–£–º–±—Ä–∏—ç–ª—å', '–¢–∏—Ç–∞–Ω–∏—è', '–û–±–µ—Ä–∞–Ω', '–¢–µ–º–ø–µ—Å—Ç', '–∏ –µ—â–µ 22'],
        },
        {
            name: '–ù–µ–ø—Ç—É–Ω',
            size: 18,
            distance: 620,
            orbitSpeed: 0.006,
            color: 0x3333ff,
            img: 'https://solarsystem.nasa.gov/system/feature_items/images/30_neptune.png',
            modelUrl: 'https://raw.githubusercontent.com/2ndVariety/3d-models/master/planets/neptune.glb',
            description: '–î–∞–ª—å–Ω—è—è –ø–ª–∞–Ω–µ—Ç–∞.',
            diameter: 49244,
            temperature: -218,
            gravity: 11.15,
            dayLength: 16.1,
            moons: ['–¢—Ä–∏—Ç–æ–Ω', '–ü—Ä–æ—Ç–µ–π', '–ù–µ—Ä–µ–∏–¥–∞', '–õ–∞—Ä–∏—Å–∞', '–¢–∞–ª–∞—Å—Å–∞', '–î–µ—Å–ø–∏–Ω–∞', '–∏ –µ—â–µ 12'],
        },
        {
            name: '–ü–ª—É—Ç–æ–Ω', // –ö–∞—Ä–ª–∏–∫–æ–≤–∞—è –ø–ª–∞–Ω–µ—Ç–∞
            size: 2,
            distance: 820,
            orbitSpeed: 0.004,
            color: 0x999999,
            img: 'https://solarsystem.nasa.gov/system/feature_items/images/40_pluto.png',
            modelUrl: 'https://raw.githubusercontent.com/2ndVariety/3d-models/master/planets/pluto.glb',
            description: '–ö–∞—Ä–ª–∏–∫–æ–≤–∞—è –ø–ª–∞–Ω–µ—Ç–∞, —Ä–∞–Ω–µ–µ —Å—á–∏—Ç–∞–≤—à–∞—è—Å—è –¥–µ–≤—è—Ç–æ–π.',
            diameter: 2376,
            temperature: -229,
            gravity: 0.62,
            dayLength: 153.3,
            moons: ['–•–∞—Ä–æ–Ω', '–ù–∏–∫—Å', '–ì–∏–¥—Ä–∞', '–ö–µ—Ä–±–µ—Ä–æ—Å', '–°—Ç–∏–∫—Å']
        }
    ];


        const sunMaterial = new THREE.MeshStandardMaterial({
            color: 0xffff00,
            emissive: 0xffff00,
            emissiveIntensity: 2
        });

        const sunGeometry = new THREE.SphereGeometry(50, 32, 32);
        const sun = new THREE.Mesh(sunGeometry, sunMaterial);
        scene.add(sun);

        planetData.forEach(data => {
            const geometry = new THREE.SphereGeometry(data.size, 32, 32);
            const material = new THREE.MeshStandardMaterial({ color: data.color });
            const planet = new THREE.Mesh(geometry, material);
            scene.add(planet);

            if (data.hasRings) {
                createRings(planet, data.size * 1.5, data.size * 2, 0xaaaaaa);
            }

            planets[data.name] = {
                mesh: planet,
                distance: data.distance,
                orbitSpeed: data.orbitSpeed,
                angle: Math.random() * Math.PI * 2,
                info: data
            };

            createFocusButton(data.name);
        });

        function createRings(planet, innerRadius, outerRadius, color) {
            const ringGeometry = new THREE.RingGeometry(innerRadius, outerRadius, 64);
            const ringMaterial = new THREE.MeshBasicMaterial({ color, side: THREE.DoubleSide });
            const ring = new THREE.Mesh(ringGeometry, ringMaterial);
            ring.rotation.x = Math.PI / 2;
            planet.add(ring);
        }

        function createFocusButton(name) {
            const button = document.createElement('button');
            button.innerText = name;
            button.onclick = () => focusOnPlanet(name);
            document.getElementById('focus-panel').appendChild(button);
        }

        function showInfo(name) {
            const info = planets[name].info;
            document.getElementById('info-image').src = info.img;
            document.getElementById('info-name').innerText = `üåç ${info.name}`;
            document.getElementById('info-description').innerText = `üìú ${info.description}`;
            document.getElementById('info-distance').innerText = `üìè –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${info.distance} –º–ª–Ω –∫–º`;
            document.getElementById('info-diameter').innerText = `‚ö™ –î–∏–∞–º–µ—Ç—Ä: ${info.diameter} –∫–º`;
            document.getElementById('info-temperature').innerText = `üå° –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${info.temperature}¬∞C`;
            document.getElementById('info-panel').style.display = 'flex';
        }

        function focusOnPlanet(name) {
            const planet = planets[name];
            if (!planet) return;
        
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–ª–∞–Ω–µ—Ç–µ
            showInfo(name);
        
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–∫—É—Å –Ω–∞ –ø–ª–∞–Ω–µ—Ç—É
            focusedPlanet = planet;
        
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∫–∞–º–µ—Ä—ã –¥–ª—è –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è –∫ –ø–ª–∞–Ω–µ—Ç–µ
            const planetPosition = planet.mesh.position.clone();
            const cameraOffset = new THREE.Vector3(0, 50, 200); // –°–º–µ—â–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø–ª–∞–Ω–µ—Ç—ã
            const targetPosition = planetPosition.add(cameraOffset);
        
            // –ü–ª–∞–≤–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã –∫ –ø–ª–∞–Ω–µ—Ç–µ
            new TWEEN.Tween(camera.position)
                .to(targetPosition, 1000) // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∫–∞–º–µ—Ä—É –∫ –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
                .easing(TWEEN.Easing.Quadratic.Out)
                .start();
        
            // –ü–ª–∞–≤–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ü–µ–ª–∏ –∫–∞–º–µ—Ä—ã –∫ –ø–ª–∞–Ω–µ—Ç–µ
            new TWEEN.Tween(controls.target)
                .to(planetPosition, 1000) // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ü–µ–ª—å –∫–∞–º–µ—Ä—ã –∫ –ø–ª–∞–Ω–µ—Ç–µ
                .easing(TWEEN.Easing.Quadratic.Out)
                .start();
        
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–í—ã–π—Ç–∏ –∏–∑ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è"
            document.getElementById('exit-observe').style.display = 'block';
        
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–í—ã–π—Ç–∏ –∏–∑ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è"
            document.getElementById('exit-observe').onclick = () => {
                exitObservationMode();
            };
        }

        function animate() {
            requestAnimationFrame(animate);
            TWEEN.update(); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–π TWEEN
        
            for (let name in planets) {
                let planet = planets[name];
                planet.angle += planet.orbitSpeed * 0.005;
                planet.mesh.position.x = Math.cos(planet.angle) * planet.distance;
                planet.mesh.position.z = Math.sin(planet.angle) * planet.distance;
        
                if (focusedPlanet === planet) {
                    const targetPosition = planet.mesh.position.clone().add(new THREE.Vector3(0, 50, 200));
                    camera.position.lerp(targetPosition, 0.05);
                    controls.target.lerp(planet.mesh.position, 0.05);
                    camera.lookAt(planet.mesh.position);
                }
            }
        
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        const exitButton = document.getElementById('exit-observe');

        function exitObservationMode() {
            // –ò—Å—Ö–æ–¥–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –∫–∞–º–µ—Ä—ã
            const initialCameraPosition = new THREE.Vector3(0, 300, 1000);
            const initialTarget = new THREE.Vector3(0, 0, 0);
        
            // –ü–ª–∞–≤–Ω–æ–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ
            new TWEEN.Tween(camera.position)
                .to(initialCameraPosition, 1000)
                .easing(TWEEN.Easing.Quadratic.Out)
                .start();
        
            // –ü–ª–∞–≤–Ω–æ–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ —Ü–µ–ª–∏ –∫–∞–º–µ—Ä—ã –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ
            new TWEEN.Tween(controls.target)
                .to(initialTarget, 1000)
                .easing(TWEEN.Easing.Quadratic.Out)
                .start();
        
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ –∫–Ω–æ–ø–∫—É "–í—ã–π—Ç–∏ –∏–∑ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è"
            document.getElementById('info-panel').style.display = 'none';
            document.getElementById('constellation-info-panel').style.display = 'none';
            document.getElementById('exit-observe').style.display = 'none';
        
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ–∫—É—Å –Ω–∞ –ø–ª–∞–Ω–µ—Ç—É
            focusedPlanet = null;
        }

        function handlePlanetClick(name) {
            if (focusedPlanet && focusedPlanet.info.name === name) {
                document.getElementById('info-panel').style.display = 'none';
                focusedPlanet = null;
                exitButton.style.display = 'none';
            } else {
                focusOnPlanet(name);
                exitButton.style.display = 'block';
            }
        }

        Object.keys(planets).forEach(name => {
            planets[name].mesh.userData = { planetName: name };
        });

        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        window.addEventListener('click', event => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(Object.values(planets).map(p => p.mesh));

            if (intersects.length > 0) {
                const clickedPlanet = intersects[0].object.userData.planetName;
                handlePlanetClick(clickedPlanet);
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–≤–µ–∑–¥ (—Ñ–æ–Ω)
    function generateStars(count) {
        for (let i = 0; i < count; i++) {
            const azimuth = (Math.random() - 0.5) * 2 * Math.PI; // –ê–∑–∏–º—É—Ç –æ—Ç -œÄ –¥–æ œÄ
            const elevation = (Math.random() - 0.5) * Math.PI; // –£–≥–æ–ª –≤–æ–∑–≤—ã—à–µ–Ω–∏—è –æ—Ç -œÄ/2 –¥–æ œÄ/2
            const starPosition = sphericalToCartesian(skyRadius, azimuth, elevation);
            createStar(starPosition.x, starPosition.y, starPosition.z, Math.random() * 1.5 + 0.5, 0xffffff);
        }
    }

    function focusOnConstellation(constellation) {
        // –ü–æ–ª—É—á–∞–µ–º —Ü–µ–Ω—Ç—Ä —Å–æ–∑–≤–µ–∑–¥–∏—è
        const center = getConstellationCenter(constellation.points);
    
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∫–∞–º–µ—Ä—ã –¥–ª—è –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è –∫ —Å–æ–∑–≤–µ–∑–¥–∏—é
        const distanceToConstellation = 300; // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –∫–∞–º–µ—Ä–∞ –ø—Ä–∏–±–ª–∏–∑–∏—Ç—Å—è –∫ —Å–æ–∑–≤–µ–∑–¥–∏—é
        const cameraOffset = new THREE.Vector3(0, 50, distanceToConstellation); // –°–º–µ—â–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–Ω—Ç—Ä–∞ —Å–æ–∑–≤–µ–∑–¥–∏—è
        const targetPosition = new THREE.Vector3().addVectors(center, cameraOffset);
    
        // –ü–ª–∞–≤–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã –∫ —Å–æ–∑–≤–µ–∑–¥–∏—é
        new TWEEN.Tween(camera.position)
            .to(targetPosition, 1000) // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∫–∞–º–µ—Ä—É –∫ –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
            .easing(TWEEN.Easing.Quadratic.Out)
            .start();
    
        // –ü–ª–∞–≤–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ü–µ–ª–∏ –∫–∞–º–µ—Ä—ã –∫ —Ü–µ–Ω—Ç—Ä—É —Å–æ–∑–≤–µ–∑–¥–∏—è
        new TWEEN.Tween(controls.target)
            .to(center, 1000) // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ü–µ–ª—å –∫–∞–º–µ—Ä—ã –∫ —Ü–µ–Ω—Ç—Ä—É —Å–æ–∑–≤–µ–∑–¥–∏—è
            .easing(TWEEN.Easing.Quadratic.Out)
            .start();
    
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ–∑–≤–µ–∑–¥–∏–∏
        showConstellationInfo(constellation);
    
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–í—ã–π—Ç–∏ –∏–∑ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è"
        document.getElementById('exit-observe').style.display = 'block';
    
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–í—ã–π—Ç–∏ –∏–∑ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è"
        document.getElementById('exit-observe').onclick = () => {
            exitObservationMode();
        };
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–≤–µ–∑–¥
    function createStar(x, y, z, size = 1, color = 0xffffff) {
        const starGeometry = new THREE.SphereGeometry(size, 16, 16);
        const starMaterial = new THREE.MeshBasicMaterial({ color });
        const star = new THREE.Mesh(starGeometry, starMaterial);
        star.position.set(x, y, z);
        scene.add(star);
        return star;
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ª–∏–Ω–∏–π —Å–æ–∑–≤–µ–∑–¥–∏—è
    function createConstellationLine(points, color = 0xffffff) {
        const lineGeometry = new THREE.BufferGeometry();
        const vertices = [];
    
        points.forEach(point => {
            vertices.push(point.x, point.y, point.z);
        });
    
        lineGeometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
    
        const lineMaterial = new THREE.LineBasicMaterial({ color, linewidth: 1 });
        const constellationLine = new THREE.Line(lineGeometry, lineMaterial);
        scene.add(constellationLine);
        return constellationLine;
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–∑–≤–µ–∑–¥–∏—è
    function createConstellation(points, constellationData) {
        const stars = [];
        const lines = [];
    
        points.forEach(point => {
            const star = createStar(point.x, point.y, point.z);
            stars.push(star);
        });
    
        const line = createConstellationLine(points);
        line.userData = { constellation: constellationData };
        lines.push(line);
    
        return { stars, lines, name: constellationData.name };
    }

    function handleConstellationClick(constellation) {
        focusOnConstellation(constellation);
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Å—Ñ–µ—Ä–∏—á–µ—Å–∫–∏—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ –¥–µ–∫–∞—Ä—Ç–æ–≤—ã
    function sphericalToCartesian(radius, azimuth, elevation) {
        const x = radius * Math.cos(elevation) * Math.cos(azimuth);
        const y = radius * Math.cos(elevation) * Math.sin(azimuth);
        const z = radius * Math.sin(elevation);
        return new THREE.Vector3(x, y, z);
    }

    // –†–∞–¥–∏—É—Å –Ω–µ–±–µ—Å–Ω–æ–π —Å—Ñ–µ—Ä—ã
    const skyRadius = 2000;

    // –°–æ–∑–≤–µ–∑–¥–∏—è
    const constellations = [
    {
        name: "–û—Ä–∏–æ–Ω",
        points: [
            sphericalToCartesian(skyRadius, -0.5, 0.2),
            sphericalToCartesian(skyRadius, -0.4, 0.3),
            sphericalToCartesian(skyRadius, -0.3, 0.2),
            sphericalToCartesian(skyRadius, -0.2, 0.3),
            sphericalToCartesian(skyRadius, -0.1, 0.2),
            sphericalToCartesian(skyRadius, -0.2, 0.1),
            sphericalToCartesian(skyRadius, -0.3, 0.2),
            sphericalToCartesian(skyRadius, -0.4, 0.1),
            sphericalToCartesian(skyRadius, -0.5, 0.2)
        ],
        description: "–û—Ä–∏–æ–Ω ‚Äî –æ–¥–Ω–æ –∏–∑ —Å–∞–º—ã—Ö —è—Ä–∫–∏—Ö –∏ —É–∑–Ω–∞–≤–∞–µ–º—ã—Ö —Å–æ–∑–≤–µ–∑–¥–∏–π –Ω–∞ –Ω–æ—á–Ω–æ–º –Ω–µ–±–µ. –û–Ω–æ –Ω–∞–∑–≤–∞–Ω–æ –≤ —á–µ—Å—Ç—å –æ—Ö–æ—Ç–Ω–∏–∫–∞ –û—Ä–∏–æ–Ω–∞ –∏–∑ –≥—Ä–µ—á–µ—Å–∫–æ–π –º–∏—Ñ–æ–ª–æ–≥–∏–∏.",
        stars: ["–ë–µ—Ç–µ–ª—å–≥–µ–π–∑–µ", "–†–∏–≥–µ–ª—å", "–ë–µ–ª–ª–∞—Ç—Ä–∏–∫—Å"],
        mythology: "–û—Ä–∏–æ–Ω –±—ã–ª –≤–µ–ª–∏–∫–∏–º –æ—Ö–æ—Ç–Ω–∏–∫–æ–º, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –ø–æ–º–µ—â–µ–Ω –Ω–∞ –Ω–µ–±–æ –ø–æ—Å–ª–µ —Å–≤–æ–µ–π —Å–º–µ—Ä—Ç–∏.",
        bestView: "–ó–∏–º–Ω–∏–µ –º–µ—Å—è—Ü—ã –≤ —Å–µ–≤–µ—Ä–Ω–æ–º –ø–æ–ª—É—à–∞—Ä–∏–∏."
    },
    {
        name: "–ë–æ–ª—å—à–∞—è –ú–µ–¥–≤–µ–¥–∏—Ü–∞",
        points: [
            sphericalToCartesian(skyRadius, 0.8, 0.5),
            sphericalToCartesian(skyRadius, 0.9, 0.6),
            sphericalToCartesian(skyRadius, 1.0, 0.5),
            sphericalToCartesian(skyRadius, 1.1, 0.6),
            sphericalToCartesian(skyRadius, 1.2, 0.5),
            sphericalToCartesian(skyRadius, 1.1, 0.4),
            sphericalToCartesian(skyRadius, 1.0, 0.5)
        ],
        description: "–ë–æ–ª—å—à–∞—è –ú–µ–¥–≤–µ–¥–∏—Ü–∞ ‚Äî –æ–¥–Ω–æ –∏–∑ —Å–∞–º—ã—Ö –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å–æ–∑–≤–µ–∑–¥–∏–π –≤ —Å–µ–≤–µ—Ä–Ω–æ–º –ø–æ–ª—É—à–∞—Ä–∏–∏. –û–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –∞—Å—Ç–µ—Ä–∏–∑–º –ë–æ–ª—å—à–æ–π –ö–æ–≤—à.",
        stars: ["–î—É–±—Ö–µ", "–ú–µ—Ä–∞–∫", "–§–µ–∫–¥–∞", "–ú–µ–≥—Ä–µ—Ü", "–ê–ª–∏–æ—Ç", "–ú–∏—Ü–∞—Ä", "–ê–ª—å–∫–∞–∏–¥"],
        mythology: "–°–æ–∑–≤–µ–∑–¥–∏–µ —Å–≤—è–∑–∞–Ω–æ —Å –º–∏—Ñ–æ–º –æ –ö–∞–ª–ª–∏—Å—Ç–æ, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∞ –≤ –º–µ–¥–≤–µ–¥–∏—Ü—É.",
        bestView: "–í–∏–¥–Ω–æ –∫—Ä—É–≥–ª—ã–π –≥–æ–¥ –≤ —Å–µ–≤–µ—Ä–Ω–æ–º –ø–æ–ª—É—à–∞—Ä–∏–∏."
    },
    // –î–æ–±–∞–≤—å—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–æ–∑–≤–µ–∑–¥–∏—è —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º, –∑–≤–µ–∑–¥–∞–º–∏, –º–∏—Ñ–æ–ª–æ–≥–∏–µ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
];

    // –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–∑–≤–µ–∑–¥–∏–π
    // –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–∑–≤–µ–∑–¥–∏–π
    const constellationObjects = constellations.map(constellation => 
    createConstellation(constellation.points, constellation)
);

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π —Å–æ–∑–≤–µ–∑–¥–∏–π
    addConstellationLabels(constellations);

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–∏—Å–∫–∞
    setupSearch(constellations);

    function showConstellationInfo(constellation) {
        const infoPanel = document.getElementById('constellation-info-panel');
        if (!constellation) {
            infoPanel.style.display = 'none';
            return;
        }
    
        document.getElementById('constellation-name').innerText = constellation.name;
        document.getElementById('constellation-description').innerText = constellation.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è';
        document.getElementById('constellation-stars').innerText = constellation.stars?.join(', ') || '–ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–≤–µ–∑–¥–∞—Ö';
        document.getElementById('constellation-mythology').innerText = constellation.mythology || '–ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–∏—Ñ–æ–ª–æ–≥–∏–∏';
        document.getElementById('constellation-best-view').innerText = constellation.bestView || '–ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è';
    
        infoPanel.style.display = 'block';
    
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–∞–Ω–µ–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        document.getElementById('close-constellation-info').onclick = () => {
            infoPanel.style.display = 'none';
        };
    }

    function createMoons(planet, moonsData) {
        const moons = [];
        const moonDistance = planet.geometry.parameters.radius * 3; // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –ø–ª–∞–Ω–µ—Ç—ã –¥–æ —Å–ø—É—Ç–Ω–∏–∫–∞
    
        moonsData.forEach((moonName, index) => {
            const moonGeometry = new THREE.SphereGeometry(2, 16, 16); // –†–∞–∑–º–µ—Ä —Å–ø—É—Ç–Ω–∏–∫–∞
            const moonMaterial = new THREE.MeshStandardMaterial({ color: 0xaaaaaa });
            const moon = new THREE.Mesh(moonGeometry, moonMaterial);
    
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º —Å–ø—É—Ç–Ω–∏–∫ –≤–æ–∫—Ä—É–≥ –ø–ª–∞–Ω–µ—Ç—ã
            const angle = (index / moonsData.length) * Math.PI * 2;
            moon.position.x = Math.cos(angle) * moonDistance;
            moon.position.z = Math.sin(angle) * moonDistance;
    
            planet.add(moon); // –î–æ–±–∞–≤–ª—è–µ–º —Å–ø—É—Ç–Ω–∏–∫ –∫ –ø–ª–∞–Ω–µ—Ç–µ
            moons.push(moon);
        });
    
        return moons;
    }
    
    // –í —Ü–∏–∫–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞–Ω–µ—Ç –¥–æ–±–∞–≤–ª—è–µ–º —Å–ø—É—Ç–Ω–∏–∫–∏
    planetData.forEach(data => {
        const planet = planets[data.name].mesh;
        if (data.moons && data.moons.length > 0) {
            createMoons(planet, data.moons);
        }
    });

function addConstellationLabels(constellations) {
    constellations.forEach(constellation => {
        const center = getConstellationCenter(constellation.points);
        const label = document.createElement('div');
        label.className = 'constellation-label';
        label.innerText = constellation.name;
        label.style.left = `${(center.x / window.innerWidth) * 100}%`;
        label.style.top = `${(center.y / window.innerHeight) * 100}%`;
        document.body.appendChild(label);
    });
}

function getConstellationCenter(points) {
    const center = new THREE.Vector3();
    points.forEach(point => center.add(point));
    center.divideScalar(points.length); // –°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
    return center;
}

function setupSearch(constellations) {
    const searchInput = document.getElementById('search-input');
    const searchResults = document.getElementById('search-results');

    searchInput.addEventListener('input', () => {
        const query = searchInput.value.toLowerCase();
        searchResults.innerHTML = '';

        if (query) {
            constellations.forEach(constellation => {
                if (constellation.name.toLowerCase().includes(query)) {
                    const result = document.createElement('div');
                    result.innerText = constellation.name;
                    result.style.cursor = 'pointer';
                    result.style.padding = '5px';
                    result.style.color = '#00ffcc';
                    result.addEventListener('click', () => {
                        focusOnConstellation(constellation);
                        searchInput.value = '';
                        searchResults.innerHTML = '';
                    });
                    searchResults.appendChild(result);
                }
            });
        }
    });
}

function focusOnConstellation(constellation) {
    const center = getConstellationCenter(constellation.points);
    camera.position.set(center.x * 1.5, center.y * 1.5, center.z * 1.5);
    controls.target.set(center.x, center.y, center.z);
    showConstellationInfo(constellation);
}

function highlightConstellation(constellation, highlight = true) {
    if (!constellation) return;

    constellation.lines.forEach(line => {
        line.material.color.set(highlight ? 0xff0000 : 0xffffff); // –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
        if (highlight) {
            new TWEEN.Tween(line.material)
                .to({ opacity: 1 }, 300)
                .start();
        } else {
            new TWEEN.Tween(line.material)
                .to({ opacity: 0.5 }, 300)
                .start();
        }
    });
}
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è —Å–æ–∑–≤–µ–∑–¥–∏—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
    function highlightConstellation(constellation, highlight = true) {
        constellation.lines.forEach(line => {
            line.material.color.set(highlight ? 0xff0000 : 0xffffff); // –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
        });
    }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–≤–µ–¥–µ–Ω–∏—è –Ω–∞ —Å–æ–∑–≤–µ–∑–¥–∏–µ
        window.addEventListener('mousemove', event => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(constellationObjects.flatMap(c => [...c.lines, ...c.stars]));
        
            // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö —Å–æ–∑–≤–µ–∑–¥–∏–π
            constellationObjects.forEach(constellation => {
                highlightConstellation(constellation, false);
            });
        
            // –í—ã–¥–µ–ª—è–µ–º —Å–æ–∑–≤–µ–∑–¥–∏–µ, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –Ω–∞–≤–µ–¥–µ–Ω –∫—É—Ä—Å–æ—Ä
            if (intersects.length > 0) {
                const hoveredObject = intersects[0].object;
                const hoveredConstellation = constellationObjects.find(c => 
                    c.lines.includes(hoveredObject) || c.stars.includes(hoveredObject)
                );
                if (hoveredConstellation) {
                    highlightConstellation(hoveredConstellation, true);
                }
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ —Å–æ–∑–≤–µ–∑–¥–∏–µ
        window.addEventListener('click', event => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(constellationObjects.flatMap(c => [...c.lines, ...c.stars]));
        
            if (intersects.length > 0) {
                const clickedObject = intersects[0].object;
                const clickedConstellation = constellationObjects.find(c => 
                    c.lines.includes(clickedObject) || c.stars.includes(clickedObject)
                );
                if (clickedConstellation) {
                    handleConstellationClick(clickedConstellation);
                }
            }
        });

        document.getElementById('exit-observe').addEventListener('click', exitObservationMode);
generateStars();

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–≤–µ–∑–¥ (—Ñ–æ–Ω)
    function generateStars(count = 10000) {
        const starGeometry = new THREE.BufferGeometry();
        const starVertices = [];
        const starColors = [];
    
        for (let i = 0; i < count; i++) {
            const radius = 5000; // –†–∞–¥–∏—É—Å —Å—Ñ–µ—Ä—ã, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥—É—Ç –∑–≤–µ–∑–¥—ã
            const theta = Math.random() * Math.PI * 2; // –ê–∑–∏–º—É—Ç
            const phi = Math.acos((Math.random() * 2) - 1); // –£–≥–æ–ª –≤–æ–∑–≤—ã—à–µ–Ω–∏—è
    
            const x = radius * Math.sin(phi) * Math.cos(theta);
            const y = radius * Math.sin(phi) * Math.sin(theta);
            const z = radius * Math.cos(phi);
    
            starVertices.push(x, y, z);
    
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –∑–≤–µ–∑–¥
            const color = new THREE.Color();
            color.setHSL(Math.random(), 0.5, 0.5);
            starColors.push(color.r, color.g, color.b);
        }
    
        starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
        starGeometry.setAttribute('color', new THREE.Float32BufferAttribute(starColors, 3));
    
        const starMaterial = new THREE.PointsMaterial({ 
            size: 1.5, 
            vertexColors: true, 
            transparent: true, 
            opacity: 0.8 
        });
    
        const stars = new THREE.Points(starGeometry, starMaterial);
        scene.add(stars);
    }
    
    generateStars(10000);

    </script>
</body>
</html>