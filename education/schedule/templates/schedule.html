{% extends 'base.html' %}

{% block content %}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid #000000;
        }
        th {
            background-color: #757272;
        }

        td {
           background-color: #757272;
        }
        .back-button {
            margin-bottom: 20px;
            display: inline-block;
            background-color: #f44336;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
        }
        .delete-btn {
            background-color: #f44336;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .delete-btn:hover {
            background-color: #d32f2f;
        }
        input[type="time"], input[type="text"] {
            width: 100%;
            padding: 5px;
            margin: 5px 0;
            box-sizing: border-box;
        }
        input[type="submit"], button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        input[type="submit"]:hover, button:hover {
            background-color: #45a049;
        }

        .search-box {
            display: none;
        }

        .container {
            max-width: 950px;
        }

        /* –£–±–æ—Ä–∫–∞ –ª–∏—à–Ω–∏—Ö —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã SVG */
        .center-line {
            display: none;
        }  

        .title-container {
            display: none;
        }

        .paragraph-container {
            display: none;
        }

        .h2 {
            display: none;
        }

        .h3 {
            display: none;
        }

        #character-container {
            display: none;
        }

        .svg-container {
            display: none;
        }

        h1 {
            position: relative;
            top: -20px;
            right: 25%;
        }
    </style>
</head>
<body>
    <h1>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h1>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –ø–µ—Ä—Å–æ–Ω–∞–∂—É -->
    <a href="{% url 'character_status' %}" class="back-button">üîô –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–µ—Ä—Å–æ–Ω–∞–∂—É</a>

    <form method="POST">
        <table>
            <thead>
                <tr>
                    <th>–í—Ä–µ–º—è</th>
                    <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                <!-- –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ -->
                <tr data-day="monday">
                    <td colspan="3" style="background-color: #1b9d92; font-weight: bold;">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</td>
                </tr>
                <tr data-day="monday">
                    <td><input type="time" name="monday_time_1" value="08:30" required></td>
                    <td><input type="text" name="monday_lesson_1" value="–§–∏–∑—Ä–∞" required></td>
                    <td><button type="button" class="delete-btn" onclick="deleteLesson('monday', 1)">–£–¥–∞–ª–∏—Ç—å</button></td>
                </tr>
                <tr data-day="monday">
                    <td><input type="time" name="monday_time_2" value="09:00" required></td>
                    <td><input type="text" name="monday_lesson_2" value="–ê–Ω–≥–ª–∏–π—Å–∫–∏–π" required></td>
                    <td><button type="button" class="delete-btn" onclick="deleteLesson('monday', 2)">–£–¥–∞–ª–∏—Ç—å</button></td>
                </tr>
                <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—Ä–æ–∫–∞ -->
                <tr data-day="monday">
                    <td><input type="time" name="monday_new_time" required></td>
                    <td><input type="text" name="monday_new_lesson" required></td>
                    <td><button type="button" onclick="addLesson('monday')">–î–æ–±–∞–≤–∏—Ç—å</button></td>
                </tr>
                
                <!-- –í—Ç–æ—Ä–Ω–∏–∫ -->
                <tr data-day="tuesday">
                    <td colspan="3" style="background-color: #1b9d92; font-weight: bold;">–í—Ç–æ—Ä–Ω–∏–∫</td>
                </tr>
                <tr data-day="tuesday">
                    <td><input type="time" name="tuesday_time_1" value="08:30" required></td>
                    <td><input type="text" name="tuesday_lesson_1" value="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞" required></td>
                    <td><button type="button" class="delete-btn" onclick="deleteLesson('tuesday', 1)">–£–¥–∞–ª–∏—Ç—å</button></td>
                </tr>
                <tr data-day="tuesday">
                    <td><input type="time" name="tuesday_time_2" value="09:00" required></td>
                    <td><input type="text" name="tuesday_lesson_2" value="–†—É—Å—Å–∫–∏–π" required></td>
                    <td><button type="button" class="delete-btn" onclick="deleteLesson('tuesday', 2)">–£–¥–∞–ª–∏—Ç—å</button></td>
                </tr>
                <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—Ä–æ–∫–∞ -->
                <tr data-day="tuesday">
                    <td><input type="time" name="tuesday_new_time" required></td>
                    <td><input type="text" name="tuesday_new_lesson" required></td>
                    <td><button type="button" onclick="addLesson('tuesday')">–î–æ–±–∞–≤–∏—Ç—å</button></td>
                </tr>
                
                <!-- –°—Ä–µ–¥–∞ -->
                <tr data-day="wednesday">
                    <td colspan="3" style="background-color: #1b9d92; font-weight: bold;">–°—Ä–µ–¥–∞</td>
                </tr>
                <tr data-day="wednesday">
                    <td><input type="time" name="wednesday_time_1" value="08:30" required></td>
                    <td><input type="text" name="wednesday_lesson_1" value="–•–∏–º–∏—è" required></td>
                    <td><button type="button" class="delete-btn" onclick="deleteLesson('wednesday', 1)">–£–¥–∞–ª–∏—Ç—å</button></td>
                </tr>
                <tr data-day="wednesday">
                    <td><input type="time" name="wednesday_time_2" value="09:00" required></td>
                    <td><input type="text" name="wednesday_lesson_2" value="–ë–∏–æ–ª–æ–≥–∏—è" required></td>
                    <td><button type="button" class="delete-btn" onclick="deleteLesson('wednesday', 2)">–£–¥–∞–ª–∏—Ç—å</button></td>
                </tr>
                <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—Ä–æ–∫–∞ -->
                <tr data-day="wednesday">
                    <td><input type="time" name="wednesday_new_time" required></td>
                    <td><input type="text" name="wednesday_new_lesson" required></td>
                    <td><button type="button" onclick="addLesson('wednesday')">–î–æ–±–∞–≤–∏—Ç—å</button></td>
                </tr>
                
                <!-- –ß–µ—Ç–≤–µ—Ä–≥ -->
                <tr data-day="thursday">
                    <td colspan="3" style="background-color: #1b9d92; font-weight: bold;">–ß–µ—Ç–≤–µ—Ä–≥</td>
                </tr>
                <tr data-day="thursday">
                    <td><input type="time" name="thursday_time_1" value="08:30" required></td>
                    <td><input type="text" name="thursday_lesson_1" value="–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞" required></td>
                    <td><button type="button" class="delete-btn" onclick="deleteLesson('thursday', 1)">–£–¥–∞–ª–∏—Ç—å</button></td>
                </tr>
                <tr data-day="thursday">
                    <td><input type="time" name="thursday_time_2" value="09:00" required></td>
                    <td><input type="text" name="thursday_lesson_2" value="–ò—Å—Ç–æ—Ä–∏—è" required></td>
                    <td><button type="button" class="delete-btn" onclick="deleteLesson('thursday', 2)">–£–¥–∞–ª–∏—Ç—å</button></td>
                </tr>
                <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—Ä–æ–∫–∞ -->
                <tr data-day="thursday">
                    <td><input type="time" name="thursday_new_time" required></td>
                    <td><input type="text" name="thursday_new_lesson" required></td>
                    <td><button type="button" onclick="addLesson('thursday')">–î–æ–±–∞–≤–∏—Ç—å</button></td>
                </tr>
                
                <!-- –ü—è—Ç–Ω–∏—Ü–∞ -->
                <tr data-day="friday">
                    <td colspan="3" style="background-color: #1b9d92; font-weight: bold;">–ü—è—Ç–Ω–∏—Ü–∞</td>
                </tr>
                <tr data-day="friday">
                    <td><input type="time" name="friday_time_1" value="08:30" required></td>
                    <td><input type="text" name="friday_lesson_1" value="–ì–µ–æ–≥—Ä–∞—Ñ–∏—è" required></td>
                    <td><button type="button" class="delete-btn" onclick="deleteLesson('friday', 1)">–£–¥–∞–ª–∏—Ç—å</button></td>
                </tr>
                <tr data-day="friday">
                    <td><input type="time" name="friday_time_2" value="09:00" required></td>
                    <td><input type="text" name="friday_lesson_2" value="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞" required></td>
                    <td><button type="button" class="delete-btn" onclick="deleteLesson('friday', 2)">–£–¥–∞–ª–∏—Ç—å</button></td>
                </tr>
                <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—Ä–æ–∫–∞ -->
                <tr data-day="friday">
                    <td><input type="time" name="friday_new_time" required></td>
                    <td><input type="text" name="friday_new_lesson" required></td>
                    <td><button type="button" onclick="addLesson('friday')">–î–æ–±–∞–≤–∏—Ç—å</button></td>
                </tr>                
            </tbody>
        </table>
    </form>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —É—Ä–æ–∫–∞
        function deleteLesson(day, lessonId) {
            const timeInput = document.querySelector(`input[name='${day}_time_${lessonId}']`);
            const lessonInput = document.querySelector(`input[name='${day}_lesson_${lessonId}']`);
            if (timeInput && lessonInput) {
                timeInput.value = '';
                lessonInput.value = '';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—Ä–æ–∫–∞
        function addLesson(day) {
            const timeInput = document.querySelector(`input[name='${day}_new_time']`);
            const lessonInput = document.querySelector(`input[name='${day}_new_lesson']`);
            
            if (timeInput.value && lessonInput.value) {
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td><input type="time" name="${day}_time_new" value="${timeInput.value}" required></td>
                    <td><input type="text" name="${day}_lesson_new" value="${lessonInput.value}" required></td>
                    <td><button type="button" class="delete-btn" onclick="deleteNewLesson(this)">–£–¥–∞–ª–∏—Ç—å</button></td>
                `;
                const table = document.querySelector('table tbody');
                const daySection = document.querySelector(`tr[data-day='${day}']`).parentNode;
                daySection.insertBefore(newRow, document.querySelector(`tr[data-day='${day}']`).nextSibling);
                
                // –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—è –¥–ª—è –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–≥–æ —É—Ä–æ–∫–∞
                timeInput.value = '';
                lessonInput.value = '';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —É—Ä–æ–∫–∞
        function deleteNewLesson(button) {
            button.closest('tr').remove();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏ –≤—ã–≤–æ–¥–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function checkSchedule() {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes(); // –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ –º–∏–Ω—É—Ç–∞—Ö
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'];
            let lessonFound = false;

            days.forEach(day => {
                for (let i = 1; i <= 2; i++) {
                    const timeInput = document.querySelector(`input[name='${day}_time_${i}']`);
                    const lessonInput = document.querySelector(`input[name='${day}_lesson_${i}']`);
                    if (timeInput && timeInput.value && lessonInput && lessonInput.value) {
                        const [hours, minutes] = timeInput.value.split(':');
                        const lessonTime = parseInt(hours) * 60 + parseInt(minutes);
                        if (Math.abs(currentTime - lessonTime) <= 5 && currentTime < lessonTime) {
                            alert(`–°–∫–æ—Ä–æ —É—Ä–æ–∫: ${lessonInput.value} –≤ ${timeInput.value}`);
                            lessonFound = true;
                        }
                    }
                }
            });

            if (!lessonFound) {
                alert('–ù–∞ –±–ª–∏–∂–∞–π—à–∏–µ 5 –º–∏–Ω—É—Ç —É—Ä–æ–∫–æ–≤ –Ω–µ—Ç.');
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
        setInterval(checkSchedule, 5 * 60 * 1000);
    </script>
    
</body>
</html>

{% endblock %}